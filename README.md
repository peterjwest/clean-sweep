# unlinted [![npm version][npm-badge]][npm-url] [![build status][circle-badge]][circle-url] [![coverage status][coverage-badge]][coverage-url]

General purpose project-wide linting and hygiene.

The aim of this project is lint across all plain text files in a codebase.
This project includes various general purpose whitespace and character checks, including a UTF8 validator.

## Installation:

```
npm install unlinted
```

## Usage

This will find your Git project root, and run checks on the whole project:

<!-- snippet: bash -->
```
npx unlinted
```

Or you can run on a subset of your project:

<!-- snippet: bash -->
```
npx unlinted src/
```

You can also specify a custom config file:

<!-- snippet: bash -->
```
npx unlinted src/ --config=unlinted.config.ts
```

## Rules

### Path checks

#### DS_STORE

Looks for committed DS_Store files. These are files generated by Mac OS and generally considered junk in code projects. It is recommended to gitignore these, but they often end up committed.

#### UPPERCASE_EXTENSION

Looks for files with uppercase extensions. Generally file extensions are lowercase, uppercase extensions could lead to unexpeted behaviour in some tools.

#### IGNORED_COMMITTED_FILE

Looks for files which have been committed but are gitignored. This is usually a mistake, either the file should not be committed, or the gitignore file should be updated.

### Content checks

#### MALFORMED_ENCODING

Looks for files with a malformed character encoding. This means that the file likely has encoding errors. [UTF8 checks](#utf8-checks) are only run on files which have a malformed encoding.

#### UNEXPECTED_ENCODING

Looks for files with encodings other than UTF8 or ASCII. Many codebases use these encodings exclusively, and some tools do not support old, less widely used encodings.

#### CARRIAGE_RETURN

Looks for carriage returns, often used in windows style line endings. These characters are not generally used in Mac OSX or Linux, and their precense can lead to unexpected/inconsitent behaviour in various tools.

#### TAB

Looks for tabs. Many projects indent purely with spaces, and tabs are undesirable.

#### TRAILING_WHITESPACE

Looks for whitespace at the end of lines. Trailing whitespace is generally unnecessary and messy.

#### MULTIPLE_FINAL_NEWLINES

Looks for multiple newlines at the end of files. Trailing newlines are generally unnecessary and messy.

#### NO_FINAL_NEWLINE

Looks for files with no final newline. Files without a final newline can lead to unexpected behaviour in various tools.

#### UNEXPECTED_CHARACTER

Looks for unusual unicode characters: non-ASCII, non-unicode letter and non-emoji characters. Some of these are confusing or ambiguous and could lead to unexpected behaviour.

Specific characters can be allowed using the following config:

```js
export default {
  rules: {
    CONTENT_VALIDATION: {
      rules: {
        UNEXPECTED_CHARACTER: {
          allowed: ['âœ“'],
        },
      },
    },
  },
};
```

### UTF8 checks

If your files are encoded with UTF8, they can be checked for encoding errors. These can occur when files are manipulated by different applications which are not expecting the same encoding, or applications which are not able to safely encode UTF8.

#### INVALID_BYTE

Looks for bytes which should not appear in UTF8 files. This can occur when text is copied from other files or applications.

#### UNEXPECTED_CONTINUATION_BYTE

Looks for invalid multibyte characters which have no start. This can happen when applications do not understand multibyte characters, cutting them in half.

#### MISSING_CONTINUATION_BYTE

Looks for invalid multibyte characters which have no end. This can happen when applications do not understand multibyte characters, cutting them in half.

#### OVERLONG_BYTE_SEQUENCE

Looks for invalid multibyte characters which use a reasonable but disallowed encoding.

#### INVALID_CODE_POINT

Looks for invalid unicode values. These values are generally meaningless/undesirable, although some can be part of [private use areas](https://en.wikipedia.org/wiki/Private_Use_Areas) which _may_ be used by companies internally.

## Configuration

By default unlinted looks in the root of your git repository for your config file named `unlinted.config.ts`, falling back to `unlinted.config.js` and then `unlinted.config.json`.

Alternatively, you can specify a custom JS, TS or JSON configuration file with `--config=<path>`.

The default config is as follows:

```js
import { DEFAULT_CONTENT_EXCLUDED } from 'unlinted';

export default {
  enabled: true,
  exclude: [],
  rules: {
    PATH_VALIDATION: {
      enabled: true,
      exclude: [],
      rules: {
        DS_STORE: { enabled: true, exclude: [] },
        UPPERCASE_EXTENSION: { enabled: true, exclude: [] },
        IGNORED_COMMITTED_FILE: { enabled: true, exclude: [] },
      },
    },
    CONTENT_VALIDATION: {
      enabled: true,
      exclude: DEFAULT_CONTENT_EXCLUDED,
      rules: {
        MALFORMED_ENCODING: { enabled: true, exclude: [] },
        UNEXPECTED_ENCODING: { enabled: true, exclude: [] },
        CARRIAGE_RETURN: { enabled: true, exclude: [] },
        TAB: { enabled: true, exclude: [] },
        TRAILING_WHITESPACE: { enabled: true, exclude: [] },
        MULTIPLE_FINAL_NEWLINES: { enabled: true, exclude: [] },
        NO_FINAL_NEWLINE: { enabled: true, exclude: [] },
        UNEXPECTED_CHARACTER: { enabled: true, exclude: [], allowed: [] },
        UTF8_VALIDATION: {
          enabled: true,
          exclude: [],
          rules: {
            INVALID_BYTE: { enabled: true, exclude: [] },
            UNEXPECTED_CONTINUATION_BYTE: { enabled: true, exclude: [] },
            MISSING_CONTINUATION_BYTE: { enabled: true, exclude: [] },
            OVERLONG_BYTE_SEQUENCE: { enabled: true, exclude: [] },
            INVALID_CODE_POINT: { enabled: true, exclude: [] },
          },
        },
      },
    },
  },
};
```

When you create a configuration, you can exclude any of these keys and the default value will be used. You can also substitute any rule with a boolean to either enable it with default settings, or disable it. For example this config disables the `TAB` rule:

```js
export default {
  rules: {
    CONTENT_VALIDATION: {
      rules: {
        TAB: false,
      },
    },
  },
};
```

You could also disable all `CONTENT_VALIDATION` rules entirely:

```js
export default {
  rules: {
    CONTENT_VALIDATION: false,
  },
};
```

Your TS or JS configuration can alternatively export a function which returns a config object. This is useful for extending values from the default config. For example this config excludes all `.txt` files from being checked:

```ts
import { Config, UserConfig } from 'unlinted';

export default function config(defaultConfig: Config): UserConfig {
  return {
    exclude: [...defaultConfig.exclude, '*.txt'],
  };
}
```

Every rule has an `exclude` property which contains a list of gitignore rules to exclude from checks. It is recommended to read and understand [gitignore syntax](https://www.atlassian.com/git/tutorials/saving-changes/gitignore). Particularly you can exclude files relatie to your project root, using forward slash, for example:

```ts
import { Config, UserConfig } from 'unlinted';

export default function config(defaultConfig: Config): UserConfig {
  return {
    exclude: [...defaultConfig.exclude, '/README.md', '/.circleci/config.yml'],
  };
}
```

## Todo:

- Extend documentation
- Tests
- Autofixing
- More snippets

[npm-badge]: https://badge.fury.io/js/unlinted.svg
[npm-url]: https://www.npmjs.com/package/unlinted

[circle-badge]: https://circleci.com/gh/peterjwest/unlinted.svg?style=shield
[circle-url]: https://circleci.com/gh/peterjwest/unlinted

[coverage-badge]: https://coveralls.io/repos/peterjwest/unlinted/badge.svg?branch=main&service=github
[coverage-url]: https://coveralls.io/github/peterjwest/unlinted?branch=main
